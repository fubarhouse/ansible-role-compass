---

- hosts: all
  vars:
    clean_rvm_install: false
    rvm_autolibs_mode: disable
    ruby_version: 2.0.0
    ruby_versions:
      - 2.0.0
    ruby_packages: []
      # - sass
    secure_rvm_install: false
    install_ruby: false
    install_gems: false
  pre_tasks:
  - file:
      path: /tmp
      state: directory
      mode: 0777
  - name: Update yum cache.
    yum:
      update_cache: yes
      state: latest
    changed_when: false
    when: ansible_os_family == 'RedHat'
    failed_when: false
  - name: Update apt cache.
    apt:
      update_cache: yes
      cache_valid_time: 600
    changed_when: false
    when: ansible_os_family == 'Debian'
    failed_when: false
  - name: Install dependencies (Debian)
    package:
      name: "{{ item }}"
      state: latest
    with_items:
      - sudo
      - git
      - git-svn
      - gnupg2
      - openssh-server
      - python-dev
      - unzip
      - make
      - libcurl4-gnutls-dev
      - gettext
      - build-essential
      - ruby-full
      - ruby
      - curl
      - automake
      - libtool
      - bison
    failed_when: false
  - name: Install dependencies (RedHat)
    package:
      name: "{{ item }}"
      state: latest
    with_items:
      - sudo
      - git
      - git-svn
      - gpg
      - openssh-server
      - python
      - wget
      - gettext-devel
      - expat-devel
      - curl-devel
      - perl-devel
      - openssl-devel
      - ruby
      - libyaml-devel
      - lib64yaml-devel
      - procps
      - patch
      - java-devel
      - gcc-c++
      - readline-devel
      - bzip2
      - automake
      - libtool
      - bison
      - sqlite-devel
    failed_when: false
  - name: add travis
    user:
      name: travis
      state: present
  roles:
    - role_under_test