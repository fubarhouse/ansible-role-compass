---

- hosts: all
  vars:
    fubarhouse_user: travis
    fubarhouse_user_dir: /home/travis
    clean_rvm_install: false
    rvm_autolibs_mode: disable
    ruby_version: 2.4.0
    ruby_versions:
      - 2.4.0
    ruby_packages: []
      # - sass
    secure_rvm_install: false
  pre_tasks:
  - file:
      path: /home/travis/temp
      state: directory
      mode: 0777
  - name: Update yum cache.
    yum:
      update_cache: yes
      state: latest
    changed_when: false
    when: ansible_os_family == 'RedHat'
    failed_when: false
  - name: Update apt cache.
    apt:
      update_cache: yes
      cache_valid_time: 600
    changed_when: false
    when: ansible_os_family == 'Debian'
    failed_when: false

  - name: Install dependencies (Debian)
    become: yes
    become_user: root
    package:
      name: "{{ item }}"
      state: latest
    with_items:
      - sudo
      - git
      - git-svn
      - gnupg2
      - openssh-server
      - python-dev
      - unzip
      - make
      - libcurl4-gnutls-dev
      - gettext
      - build-essential
      - ruby-full
      - ruby
      - curl
      - automake
      - libtool
      - bison
    failed_when: false
    when: 'ansible_os_family == "Debian"'

- name: Install dependencies (RedHat)
    become: yes
    become_user: root
    package:
      name: "{{ item }}"
      state: latest
    with_items:
      - git
      - git-svn
      - gpg
      - openssh-server
      - wget
      - gettext-devel
      - expat-devel
      - curl-devel
      - perl-devel
      - ruby
      - procps
      - patch
      - java-devel
      - gcc-c++
      - readline-devel
      - bzip2
      - automake
      - libtool
      - bison
      - sqlite-devel
    failed_when: false
    when: 'ansible_os_family == "RedHat"'

  roles:
    - role_under_test